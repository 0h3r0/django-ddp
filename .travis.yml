# .travis.yml automatically generated by ".travis.yml.sh"

# Container-based builds used if "sudo: false" --> fast boot (1-6s)
# https://docs.travis-ci.com/user/ci-environment/
sudo: false

language: python
python:
  - "2.7"
  - "3.3"
  - "3.4"
  - "3.5"
  - "pypy"
  - "pypy3"

env:
  - DJANGO="1.8"
  - DJANGO="1.9"
  - PGDATABASE="django_ddp_test_project"
  - PGUSER="postgres"

# Django 1.9 dropped support for Python 3.3
matrix:
  exclude:
    - python: "3.3"
      env: DJANGO="1.9"

services:
  - postgresql

before_install:
  - curl https://install.meteor.com/ | sh

install:
  - pip install -U tox coveralls setuptools
  - '[[ $TRAVIS_PYTHON_VERSION == "2.7" ]] && PYENV="py27"'
  - '[[ $TRAVIS_PYTHON_VERSION == "3.3" ]] && PYENV="py33"'
  - '[[ $TRAVIS_PYTHON_VERSION == "3.4" ]] && PYENV="py34"'
  - '[[ $TRAVIS_PYTHON_VERSION == "3.5" ]] && PYENV="py35"'
  - '[[ $TRAVIS_PYTHON_VERSION == "pypy" ]] && PYENV="pypy"'
  - '[[ $TRAVIS_PYTHON_VERSION == "pypy3" ]] && PYENV="pypy3"'

before_script:
  - env | sort
  - psql -c "create database ${PGDATABASE};"

script:
  - PATH="$HOME/.meteor:$PATH" tox -vvvv -e ${PYENV}-django${DJANGO}

after_success:
  coveralls
